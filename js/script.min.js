/***********************************************
	Main script file
	- depends on Zepto.js (zeptojs.com)
************************************************/window.natrelle||(window.natrelle={});natrelle.framework={frameworkContainerId:"#framework-container",pageContainerId:"#page-container",pageSelectionId:"#page-selection",section:{AUG:"aug",RECON:"recon",COVER:"cover"},augPages:[1,2,3,4,5,6,7],reconPages:[1,2,3,8,9,10,11,12,13],allPages:[1,2,3,4,5,6,7,8,9,10,11,12,13],lastPageOffset:-1,pageTitles:{1:"Cohesive gel, safety",2:"Most cohesive shaped gel",3:"Upper pole stability",4:"Anatomical contours",5:"Most selected shaped gel",6:"Ideal patient",7:"410 Matrix",8:"Anatomical shape",9:"Precise TE Match-up",10:"Precise TE Match-up",11:"<i>Natrelle</i><sup>&reg;</sup> 133 Series TE",12:"410 Matrix",13:"Ideal Patient"},currentSection:"",pageWidth:1024,initCoverPage:function(e){var t=$(this.pageContainerId);$.ajax({url:"pages/cover.html",context:document.body,error:function(t,n,r){natrelle.utils.log("error loading file: "+t.status+" "+n+" "+r);e&&e()},success:function(n,r,i){var s=natrelle.utils.getBodyFromHtml(n);t.html(s);e&&e()}})},removeAugReconPages:function(){var e=$(this.pageContainerId);e.children("article:not(:first-child)").remove()},initAugReconPages:function(callback){function getPageUrl(e){var t="page"+e+".html",n="pages/";return n+t}function addPage(number,article){function loadPages(startIndex,endIndex,cb){for(var i=startIndex;i<endIndex;i++)if(pageContents[i]==undefined){cb&&cb(!1);return}for(var i=startIndex;i<endIndex;i++)articles+=pageContents[i];$pageContainer.append(articles);for(var i=startIndex;i<endIndex;i++)eval("window.slideLoaded"+pageNumbers[i]+"();");cb&&cb(!0)}var pageIndex=pageNumbers.indexOf(number),articles="";pageContents[pageIndex]=article;addedFirst4Pages?loadPages(4,numOfPages,function(e){e&&callback&&callback()}):loadPages(0,4,function(e){e&&(addedFirst4Pages=!0)})}var $pageContainer=$(this.pageContainerId),pageNumbers=this.allPages.slice(0),addedFirst4Pages=!1,numOfPages=pageNumbers.length;pageContents=[];for(var i=1;i<=numOfPages;i++)(function(e){$.ajax({url:getPageUrl(e),context:document.body,error:function(e,t,n){natrelle.utils.log("error loading file: "+e.status+" "+t+" "+n)},success:function(t,n,r){var i=natrelle.utils.getBodyFromHtml(t);addPage(e,i)}})})(i)},pageNavigation:{init:function(){this.fw=natrelle.framework;this.$pageContainer=$(this.fw.pageContainerId);this.lastScrollOffset=0;natrelle.utils.log("init")},goToPage:function(e){var t=-e*this.fw.pageWidth;this.fw.menu.selectMenuItem(pageNumber);this.updatePosition(t);this.lastScrollOffset=t},updatePosition:function(e,t){if(e>=this.fw.lastPageOffset&&e<=0)if(t){this.$pageContainer.addClass("no-flick");if(natrelle.utils.isiOS6()){this.$pageContainer.get(0).style.webkitTransform="translate3d("+e+"px,0,0)";this.$pageContainer.get(0).style.left=""}else{this.$pageContainer.get(0).style.left=e+"px";this.$pageContainer.get(0).style.webkitTransform=""}}else{this.$pageContainer.get(0).style.webkitTransform="";this.$pageContainer.removeClass("no-flick");this.$pageContainer.get(0).style.left=e+"px"}if(e%this.fw.pageWidth==0){var n=this.fw.getPages(),r=Math.abs(e/this.fw.pageWidth),i="invisible";for(var s=0,o=n.length;s<o;s++)s<r-1||s>r+1?$("#slide-"+n[s]).addClass(i):$("#slide-"+n[s]).removeClass(i)}},resetPageSwipe:function(){this.lastScrollOffset=0;this.updatePosition(0);this.resetPageState()},resetPageState:function(slideId){var pages=this.fw.allPages.slice(0);if(slideId)eval("window.slideUnloaded"+slideId+"();");else for(var i=0,max=pages.length;i<max;i++)eval("window.slideUnloaded"+pages[i]+"();")},setupPageSwipe:function(){function s(n){var r=n.touches[0];t.x=r.pageX;t.y=r.pageY;t.time=Date.now();e.$pageContainer.on("touchmove",o);e.$pageContainer.on("touchend",u);i=!1}function o(r){var s=r.touches[0],o=0;if(e.fw.currentSection===e.fw.section.COVER||GlobalDoNotMovePage)return;n.x=s.pageX;n.y=s.pageY;n.time=Date.now();o=n.x-t.x;i=!0;e.updatePosition(e.lastScrollOffset+o,!0)}function u(r){diffTouch.x=t.x-n.x;diffTouch.y=t.y-n.y;diffTouch.time=n.time-t.time;i&&(Math.abs(diffTouch.y)<Math.abs(diffTouch.x)?diffTouch.x>50?l():diffTouch.x<-50?c():f():f());e.$pageContainer.off("touchmove",o);e.$pageContainer.off("touchend",u)}function a(t){function i(){natrelle.utils.log("endAnimation, id = "+r);e.$pageContainer.get(0).style.webkitTransition="";e.$pageContainer.get(0).style.webkitTransform="";e.$pageContainer.removeClass("no-flick");e.$pageContainer.get(0).style.left=e.lastScrollOffset+"px";r=null;t&&e.resetPageState()}function s(){natrelle.utils.isiOS6()?e.$pageContainer.get(0).style.webkitTransition="-webkit-transform 400ms ease-out":e.$pageContainer.get(0).style.webkitTransition="left 400ms ease-out";r=setTimeout(i,400);natrelle.utils.log("startAnimation, id = "+r)}var n={className:"animate",duration:400};if(r!=null){clearTimeout(r);r=setTimeout(i,400);natrelle.utils.log("clearTimeout, new animatingId = "+r)}else s()}function f(t){e.updatePosition(e.lastScrollOffset,!0);a(!1)}function l(t){if(e.fw.currentSection===e.fw.section.COVER||GlobalDoNotMovePage)return;if(e.lastScrollOffset>e.fw.lastPageOffset){e.lastScrollOffset-=e.fw.pageWidth;e.updatePosition(e.lastScrollOffset,!0);a(!0);e.fw.menu.selectNextMenuItem()}}function c(t){if(e.fw.currentSection===e.fw.section.COVER||GlobalDoNotMovePage)return;if(e.lastScrollOffset<0){e.lastScrollOffset+=e.fw.pageWidth;e.updatePosition(e.lastScrollOffset,!0);a(!0);e.fw.menu.selectPreviousMenuItem()}}var e=this,t={x:0,y:0,time:0},n=diffTouch=tmpTouch={x:0,y:0,time:0},r=null,i=!1;natrelle.utils.log("setupPageSwipe "+e.$pageContainer);e.$pageContainer.on("touchstart",s)}},getPages:function(){return this.currentSection===this.section.AUG?this.augPages:this.currentSection===this.section.RECON?this.reconPages:[]},setSection:function setSection(e){var t=natrelle.framework;if(!setSection.sections){setSection.sections="";for(var n in this.section)this.section.hasOwnProperty(n)&&(setSection.sections+=this.section[n]+" ")}t.currentSection=e;natrelle.utils.log("sectionName: "+t.currentSection);$(this.frameworkContainerId).removeClass(setSection.sections).addClass(e);$(this.pageSelectionId).removeClass(setSection.sections).addClass(e);if(e===t.section.AUG){natrelle.utils.log("it's aug: "+e);t.lastPageOffset=-t.pageWidth*(t.augPages.length-1)}else if(e===t.section.RECON){natrelle.utils.log("it's recon: "+e);t.lastPageOffset=-t.pageWidth*(t.reconPages.length-1)}},showCover:function(){function t(){e.showAug();e.pageNavigation.resetPageSwipe();r()}function n(){e.showRecon();e.pageNavigation.resetPageSwipe();r()}function r(){$augBtn.off(natrelle.utils.isTouch()?"tap":"click",t);$reconBtn.off(natrelle.utils.isTouch()?"tap":"click",n)}var e=this;$augBtn=$("#aug-button"),$reconBtn=$("#recon-button");e.setSection(this.section.COVER);$augBtn.on(natrelle.utils.isTouch()?"tap":"click",t);$reconBtn.on(natrelle.utils.isTouch()?"tap":"click",n)},showAug:function(){this.setSection(this.section.AUG)},showRecon:function(){this.setSection(this.section.RECON)},setupReferences:function(){function r(t){switch(!0){case e.hasClass("show"):e.toggleClass("show").toggleClass("hide");break;case e.hasClass("hide"):e.toggleClass("hide").toggleClass("show");break;default:e.toggleClass("show")}}var e=$("#ref-container"),t=$("#ref-open-button"),n=$("#ref-close-button");t.on(natrelle.utils.isTouch()?"tap":"click",r);n.on(natrelle.utils.isTouch()?"tap":"click",r)},setupIsi:function(){var e=this,t=$("#isi-container"),n=$("#isi-close-button"),r=$("#isi-close-button-2");n.one(natrelle.utils.isTouch()?"tap":"click",natrelle.framework.toggleIsi);r.on(natrelle.utils.isTouch()?"tap":"click",natrelle.framework.toggleIsi)},toggleIsi:function(e){var t=this,n=$("#isi-container"),r=$("#isi-close-button");e&&e.stopPropagation&&e.stopPropagation();switch(!0){case n.hasClass("show"):n.get(0).scrollTop=0;n.removeClass("no-animation").toggleClass("show").toggleClass("hide");setTimeout(function(){n.on(natrelle.utils.isTouch()?"tap":"click",natrelle.framework.toggleIsi)},500);break;case n.hasClass("hide"):n.toggleClass("hide").toggleClass("show");n.off(natrelle.utils.isTouch()?"tap":"click",natrelle.framework.toggleIsi);setTimeout(function(){r.one(natrelle.utils.isTouch()?"tap":"click",natrelle.framework.toggleIsi)},500)}},showTissueExpanderIsi:function(){natrelle.framework.toggleIsi();document.getElementById("isi-container").scrollTop=1e3},setupHomeButton:function(){var e=$("#home-open-button"),t=this;e.on(natrelle.utils.isTouch()?"tap":"click",function(e){$(natrelle.framework.pageContainerId).attr("style",null);t.showCover();t.menu.resetMenuPosition();t.pageNavigation.resetPageSwipe();t.menu.selectMenuItem(1);t.removeAugReconPages();t.initAugReconPages(function(){natrelle.utils.log("finished re-loading all pages")})})},menu:{$menuPullout:$("#menu-pullout"),$pageSelection:$("#page-selection"),$toggleButton:$("#aug-recon-toggle"),$menuItems:$("#menu-items"),pageSelectionWidth:328,menuTabWidth:48,currentPage:1,setupMenu:function(){this.fw=natrelle.framework;this.menuSection=this.fw.section.AUG;this.maxThresholdPullOutDistance=this.pageSelectionWidth-this.menuTabWidth;this.minThresholdPullOutDistance=-this.pageSelectionWidth+this.menuTabWidth;this.maxPullOutDistance=0;this.minPullOutDistance=-this.pageSelectionWidth+this.menuTabWidth;this.setMenuSection(this.fw.currentSection);this.createMenuElements();if(natrelle.utils.isTouch()){this.$menuPullout.on("touchmove",$.proxy(this.touchMove,this));this.$menuPullout.on("touchend",$.proxy(this.touchEnd,this));this.$menuPullout.on("tap",$.proxy(this.toggleMenu,this));this.$toggleButton.on("tap",$.proxy(this.toggleMenuSection,this))}else{this.$menuPullout.on("click",$.proxy(this.toggleMenu,this));this.$toggleButton.on("click",$.proxy(this.toggleMenuSection,this))}this.selectMenuItem(1)},resetMenuPosition:function(){this.setMenuPosition(this.minPullOutDistance)},selectMenuItem:function(e){var t,n="selected";t=$("#menu-page-"+e);this.$menuItems.children().removeClass(n);t.addClass(n);this.currentPage=e},selectPreviousMenuItem:function(){var e=this.currentPage,t=this.fw.getPages(),n=t.indexOf(e),r;r=n===0?t[t.length-1]:t[n-1];this.selectMenuItem(r)},selectNextMenuItem:function(){var e=this.currentPage,t=this.fw.getPages(),n=t.indexOf(e),r;r=n===t.length-1?t[0]:t[n+1];this.selectMenuItem(r)},getMenuSection:function(){return this.$pageSelection.get(0).className},setMenuSection:function(e){this.menuSection=e;this.$pageSelection.get(0).className=this.menuSection},toggleMenuSection:function(e){this.getMenuSection()===this.fw.section.AUG?this.setMenuSection(this.fw.section.RECON):this.setMenuSection(this.fw.section.AUG)},setMenuPosition:function(e){this.$pageSelection.css("left",e+"px")},touchMove:function(e){if(e.touches.length==1){var t=e.touches[0],n=t.pageX;n>=this.menuTabWidth&&n<this.pageSelectionWidth&&this.setMenuPosition(n-this.pageSelectionWidth)}},touchEnd:function(e){console.log("touchend");if(e.changedTouches.length==1){var t=e.changedTouches[0],n=t.pageX,r=this.pageSelectionWidth/2;n<r?this.setMenuPosition(this.minPullOutDistance):n>=r&&this.setMenuPosition(this.maxPullOutDistance)}},addAnimation:function(){var e=this;this.$pageSelection.addClass("animate");setTimeout(function(){e.$pageSelection.removeClass("animate")},250)},toggleMenu:function(e){var t=parseInt(this.$pageSelection.css("left"),10);this.addAnimation();t===this.minPullOutDistance?this.setMenuPosition(this.maxPullOutDistance):this.setMenuPosition(this.minPullOutDistance)},hitMenuItem:function(e){var t=this.fw.augPages.slice(),n=this.fw.reconPages.slice(),r=$(e.target),i=r.is("li")?r:r.closest("li"),s=i.attr("id"),o=this.getMenuSection(),u=o===this.fw.section.AUG?t:n;matches=null,pageNumber=-1,pageIndex=-1;if(s!=undefined){matches=s.match(/menu-page-(\d+)/);if(matches){this.fw.setSection(o);pageNumber=parseInt(matches[1],10);pageIndex=u.indexOf(pageNumber);this.fw.pageNavigation.goToPage(pageIndex);this.addAnimation();this.resetMenuPosition()}}},createMenuElements:function(){var e=this.fw.augPages.slice(),t=this.fw.reconPages.slice(),n=this.fw.pageTitles,r=document.createDocumentFragment(),i="",s="",o=e[0]<t[0]?e[0]:t[0],u=e[e.length-1]>t[t.length-1]?e[e.length-1]:t[t.length-1];for(var a=o;a<=u;a++){s="";e.indexOf(a)>=0&&(s+=this.fw.section.AUG);t.indexOf(a)>=0&&(s+=" "+this.fw.section.RECON);if(s.length>0){i=$("<li id='menu-page-"+a+"' class='"+s+"'><img src='images/thumbnails/page"+a+".png'/><div class='content'><h3>"+n[a]+"</h3><!--<p>A description might go here if there is room</p>--></div></li>").get(0);r.appendChild(i)}}this.$menuItems.empty().append(r).on(natrelle.utils.isTouch()?"tap":"click",$.proxy(this.hitMenuItem,this))}},init:function(){var e=this;GlobalDoNotMovePage=!1;this.setupIsi();this.setupReferences();this.setupHomeButton();this.pageNavigation.init();this.initCoverPage(function(){e.showCover();e.initAugReconPages(function(){natrelle.utils.log("finished loading all pages")});e.pageNavigation.setupPageSwipe()});this.menu.setupMenu()}};$(function(){natrelle.framework.init.call(natrelle.framework)});